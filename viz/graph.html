<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<style type="text/css" media="screen, print">
			body { margin: 30px 50px; font-family: sans-serif; }
		</style>
		<title></title>
	</head>
	<body>
	<h1>Graph</h1>

		<script src="../vendor/d3/d3.js"></script>
		<script>

const margin = {top: 50, right: 100, bottom: 50, left: 50};
const width = 800 - margin.left - margin.right;
const height = 500 - margin.top - margin.bottom;
const text_size = 10;

var svg = d3.select("body").append("svg")
    .attr("width", String(width + margin.left + margin.right))
    .attr("height", String(height + margin.top + margin.bottom))
	.append("g")
    .attr("transform", `translate(${margin.left},${margin.top})`);

// getColour converts a row in the dataset to a colour
function getColour(i) {
	const gradient = d3.scaleLinear().domain([1, 40])
		.range(["yellow", "blue"]);
		//.range(["#FFFFFF", "#000000"]);
		//.range(["#aeb01e", "#1e25b0"]);
	return gradient(i);
};

// Loads list of countries
d3.tsv("../data/countries.tsv", function(error, data){
	if(error) throw error;

	const countries = data;

	// Loads income data
	d3.tsv(`../data/income_gini.tsv`, function(error, data2) {
		if(error) return;
		const income = data2;

		// Create axes
			// axis x
		var scale_x = d3.scaleLinear()
			.range([0, width])
			.domain([1905,2020]);
		var xAxis = d3.axisBottom(scale_x);
			// axis y
		var scale_y = d3.scaleLinear()
			.range([height, 0])
			.domain([0,0.9]);
		var yAxis = d3.axisLeft(scale_y);

		//Draw axes
		svg.append("g")
			.attr('class', 'x axis')
			.attr("transform", `translate(0, ${height})`)
			.call(xAxis);
		svg.append("g")
			.attr("class", "y axis")
			.call(yAxis);
        // Add the text label for the X axis
        svg.append('text')
            .attr('x', width / 2)
            .attr('y', height + margin.bottom)
            .style('text-anchor', 'middle')
            .text('Year');
        // Add the text label for the Y axis
        svg.append('text')
            .attr('transform', 'rotate(-90)')
            .attr('y', -margin.left)
            .attr('x', -height / 2)
            .attr('dy', '1em')
            .style('text-anchor', 'middle')
            .text('GINI index');
/*			// add x axis label:
		svg.append("text")
			.attr("text-anchor", "end")
			.attr("font-size", text_size)
			.attr("x", width)
			.attr("y", height + margin.bottom-text_size)
			.text("Years");
			// add y axis label:
		svg.append("text")
			.attr("text-anchor", "end")
			.attr("font-size", text_size)
			.attr("y", -margin.top + text_size)
			.text("GINI index");
*/

		//Draw dots
		var count=0;
		for (let i = 0; i < countries.length; ++i) {
			current=countries[i].code;
			country_data=income.filter(function(d){return current==d.country;});
			if(country_data.length>=1){
				country_name=countries[i].name;
				var dots = svg.selectAll("dot")
       	        			.data(country_data)
		       			.enter()
					.append("svg:circle")
        	       			.attr("cx", function(d) { return scale_x(d.year); })
         	      			.attr("cy", function(d) { return scale_y(d.gini_index); })
        	       			.attr("r", "2.8px")
					.attr("fill", getColour(count))
					.append("svg:title").text(function(d){
					return country_name +" , "+d.year+" , "+d.gini_index+" , "+count;});

				// Add the path
				for (let i = 0; i < country_data.length-1; ++i) {
					var p1=country_data[i];
					var p2=country_data[i+1];
					svg.selectAll(".line")
						.data(country_data)
		       				.enter()
                				.append("line")
                				.attr("x1", function(d){return scale_x(p1.year)})
                				.attr("y1", function(d){return scale_y(p1.gini_index)})
                				.attr("x2", function(d){return scale_x(p2.year)})
                				.attr("y2", function(d){return scale_y(p2.gini_index)})
                				.style("stroke", getColour(count));
				}
				count++;
			}
		}
	});//end loads income data

});//end loads list of countries

		</script>
	</body>
</html>
